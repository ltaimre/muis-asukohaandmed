{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/liisitaimre/Documents/hello-next/components/KihMap.js\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport L from 'leaflet';\nimport fetch from 'isomorphic-unfetch';\nimport React, { Component } from 'react';\nvar elId = 'map';\nvar style = {\n  \"default\": {\n    color: '#0055B8',\n    weight: 1,\n    opacity: 1,\n    fillColor: 'red',\n    fillOpacity: 1\n  },\n  hover: {\n    color: '#0055B8',\n    weight: 4,\n    opacity: .6,\n    fillColor: 'red',\n    fillOpacity: 1\n  },\n  selected: {\n    color: '#0055B8',\n    weight: 1,\n    opacity: 1,\n    fillColor: '#0055B8',\n    fillOpacity: 1\n  }\n};\n\nvar KihMap = /*#__PURE__*/function (_Component) {\n  _inherits(KihMap, _Component);\n\n  var _super = _createSuper(KihMap);\n\n  function KihMap(props) {\n    var _this;\n\n    _classCallCheck(this, KihMap);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      id: null,\n      map: null,\n      labelFeatures: false,\n      labels: new L.FeatureGroup(),\n      layer: null,\n      cache: {},\n      clickHandler: {\n        region1922: function region1922(feature) {\n          _this.createLayer('kih1922', {\n            filters: [{\n              'PIIRKOND': feature.properties.PIIRKOND\n            }],\n            labels: true\n          });\n        },\n        kih1922: function kih1922(feature) {\n          if (feature.properties.id) {\n            window.location.href = \"./\".concat(feature.properties.id);\n          }\n        }\n      },\n      labelProperty: {\n        region1922: 'PIIRKOND',\n        kih1922: 'KIHELKOND'\n      },\n      labelClass: {\n        region1922: 'label big-label',\n        kih1922: 'label small-label'\n      }\n    };\n    return _this;\n  }\n\n  _createClass(KihMap, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.state.map = this.createMap(elId);\n      this.state.layer = L.geoJSON([], {\n        style: style[\"default\"],\n        onEachFeature: function onEachFeature(feature, featureLayer) {\n          if (_this2.state.id in _this2.state.clickHandler && _this2.props.clickable) {\n            featureLayer.on('click', function (e) {\n              _this2.state.clickHandler[_this2.state.id](feature);\n            });\n          }\n\n          if (feature._selected) {\n            featureLayer.setStyle(style.selected);\n          }\n\n          if (_this2.state.labelFeatures) {\n            var point = feature.properties.CENTROID || featureLayer.getBounds().getCenter();\n            var label = L.marker(point, {\n              interactive: false,\n              icon: L.divIcon({\n                className: _this2.state.labelClass[_this2.state.id],\n                html: \"<label>\".concat(feature.properties[_this2.state.labelProperty[_this2.state.id]], \"</label>\"),\n                iconSize: [160, 0],\n                iconAnchor: [80, 0]\n              })\n            }).addTo(_this2.state.labels);\n          }\n\n          featureLayer.on('mouseover', function (e) {\n            if (_this2.props.hover && !feature._selected) {\n              featureLayer.setStyle(style.hover);\n              featureLayer.bringToFront();\n            }\n          }).on('mouseout', function (e) {\n            if (_this2.props.hover && !feature._selected) {\n              featureLayer.setStyle(style[\"default\"]);\n            }\n          });\n        }\n      });\n      this.state.layer.addTo(this.state.map);\n      this.state.labels.addTo(this.state.map);\n\n      if (this.props.layer) {\n        this.createLayer(this.props.layer, this.props);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return __jsx(\"div\", {\n        id: \"map\",\n        className: \"map\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 12\n        }\n      }, __jsx(\"button\", {\n        className: \"back\",\n        onClick: this.handleBackClick.bind(this),\n        style: {\n          display: this.state.id === 'kih1922' && this.props.clickable ? 'block' : 'none'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 7\n        }\n      }, \"Tagasi\"));\n    }\n  }, {\n    key: \"handleBackClick\",\n    value: function handleBackClick() {\n      this.createLayer('mk', {\n        labels: true\n      });\n    }\n  }, {\n    key: \"createMap\",\n    value: function createMap(elId) {\n      var map = L.map(elId, {\n        attributionControl: false,\n        zoomControl: false,\n        zoomSnap: 0\n      }); // disable drag and zoom handlers\n\n      map.dragging.disable();\n      map.touchZoom.disable();\n      map.doubleClickZoom.disable();\n      map.scrollWheelZoom.disable();\n      return map;\n    }\n  }, {\n    key: \"load\",\n    value: function load(id) {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        if (id in _this3.state.cache) {\n          resolve(_this3.state.cache[id]);\n        } else {\n          fetch(\"/data/\".concat(id, \".geojson\")).then(function (response) {\n            return response.json();\n          }).then(function (response) {\n            _this3.state.cache[id] = response;\n            resolve(response);\n          })[\"catch\"](reject);\n        }\n      });\n    }\n  }, {\n    key: \"createLayer\",\n    value: function createLayer(id, options) {\n      var _this4 = this;\n\n      this.setState({\n        id: id,\n        labelFeatures: options.labels\n      });\n      this.state.layer.clearLayers();\n      this.state.labels.clearLayers();\n      this.load(id).then(function (response) {\n        var data = Object.assign({}, response);\n\n        if ('filters' in options && options.filters.length) {\n          data.features = data.features.filter(function (feature) {\n            var valid = [];\n            options.filters.forEach(function (item) {\n              Object.keys(item).forEach(function (key) {\n                if (key in feature.properties) {\n                  valid.push(feature.properties[key] === item[key]);\n                }\n              });\n            });\n            return valid.indexOf(true) > -1;\n          });\n        }\n\n        if ('selected' in options && options.selected.length) {\n          data.features = data.features.map(function (feature) {\n            var valid = [];\n            options.selected.forEach(function (item) {\n              Object.keys(item).forEach(function (key) {\n                if (key in feature.properties) {\n                  valid.push(feature.properties[key] === item[key]);\n                }\n              });\n            });\n\n            if (valid.indexOf(true) > -1) {\n              feature._selected = true;\n            }\n\n            return feature;\n          });\n        }\n\n        _this4.state.layer.addData(data);\n\n        _this4.state.map.fitBounds(_this4.state.layer.getBounds(), {\n          padding: [0, 0]\n        });\n      });\n    }\n  }]);\n\n  return KihMap;\n}(Component);\n\nexport default KihMap;","map":{"version":3,"sources":["/Users/liisitaimre/Documents/hello-next/components/KihMap.js"],"names":["L","fetch","React","Component","elId","style","color","weight","opacity","fillColor","fillOpacity","hover","selected","KihMap","props","state","id","map","labelFeatures","labels","FeatureGroup","layer","cache","clickHandler","region1922","feature","createLayer","filters","properties","PIIRKOND","kih1922","window","location","href","labelProperty","labelClass","createMap","geoJSON","onEachFeature","featureLayer","clickable","on","e","_selected","setStyle","point","CENTROID","getBounds","getCenter","label","marker","interactive","icon","divIcon","className","html","iconSize","iconAnchor","addTo","bringToFront","handleBackClick","bind","display","attributionControl","zoomControl","zoomSnap","dragging","disable","touchZoom","doubleClickZoom","scrollWheelZoom","Promise","resolve","reject","then","response","json","options","setState","clearLayers","load","data","Object","assign","length","features","filter","valid","forEach","item","keys","key","push","indexOf","addData","fitBounds","padding"],"mappings":"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","sourcesContent":["import L from 'leaflet'\nimport fetch from 'isomorphic-unfetch'\nimport React, { Component } from 'react'\n\nconst elId = 'map'\n\nconst style = {\n  default: {\n    color: '#0055B8',\n    weight: 1,\n    opacity: 1,\n    fillColor: 'red',\n    fillOpacity: 1\n  },\n  hover: {\n    color: '#0055B8',\n    weight: 4,\n    opacity: .6,\n    fillColor: 'red',\n    fillOpacity: 1\n  },\n  selected: {\n    color: '#0055B8',\n    weight: 1,\n    opacity: 1,\n    fillColor: '#0055B8',\n    fillOpacity: 1\n  }\n}\n\nclass KihMap extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      id: null,\n      map: null,\n      labelFeatures: false,\n      labels: new L.FeatureGroup(),\n      layer: null,\n      cache: {},\n      clickHandler: {\n        region1922: feature => {\n          this.createLayer('kih1922', {\n            filters: [{'PIIRKOND': feature.properties.PIIRKOND}],\n            labels: true\n          })\n        },\n        kih1922: feature => {\n          if (feature.properties.id) {\n            window.location.href = `./${feature.properties.id}`\n          }\n        }\n      },\n      labelProperty: {\n        region1922: 'PIIRKOND',\n        kih1922: 'KIHELKOND'\n      },\n      labelClass: {\n        region1922: 'label big-label',\n        kih1922: 'label small-label'\n      }\n    }\n  }\n\n  componentDidMount() {\n    this.state.map = this.createMap(elId)\n    this.state.layer = L.geoJSON([], {\n      style: style.default,\n      onEachFeature: (feature, featureLayer) => {\n        if (this.state.id in this.state.clickHandler && this.props.clickable) {\n          featureLayer.on('click', e => {\n            this.state.clickHandler[this.state.id](feature)\n          })\n        }\n        if (feature._selected) {\n          featureLayer.setStyle(style.selected)\n        }\n        if (this.state.labelFeatures) {\n          const point = feature.properties.CENTROID || featureLayer.getBounds().getCenter()\n          const label = L.marker(point, {\n            interactive: false,\n            icon: L.divIcon({\n              className: this.state.labelClass[this.state.id],\n              html: `<label>${feature.properties[this.state.labelProperty[this.state.id]]}</label>`,\n              iconSize: [160, 0],\n              iconAnchor: [80, 0]\n            })\n          }).addTo(this.state.labels)\n        }\n        featureLayer.on('mouseover', e => {\n          if (this.props.hover && !feature._selected) {\n            featureLayer.setStyle(style.hover)\n            featureLayer.bringToFront()\n          }\n        }).on('mouseout', e => {\n          if (this.props.hover && !feature._selected) {\n            featureLayer.setStyle(style.default)\n          }\n        })\n      }\n    })\n    this.state.layer.addTo(this.state.map)\n    this.state.labels.addTo(this.state.map)\n    if (this.props.layer) {\n      this.createLayer(this.props.layer, this.props)\n    }\n  }\n\n  render() {\n    return <div id=\"map\" className=\"map\">\n      <button\n        className=\"back\"\n        onClick={this.handleBackClick.bind(this)}\n        style={{display: this.state.id === 'kih1922' && this.props.clickable ? 'block' : 'none'}}>\n        Tagasi\n      </button>\n    </div>\n  }\n\n  handleBackClick() {\n    this.createLayer('mk', {\n      labels: true\n    })\n  }\n\n  createMap(elId) {\n    const map = L.map(elId, {\n      attributionControl: false,\n      zoomControl: false,\n      zoomSnap: 0\n    })\n    // disable drag and zoom handlers\n    map.dragging.disable()\n    map.touchZoom.disable()\n    map.doubleClickZoom.disable()\n    map.scrollWheelZoom.disable()\n    return map\n  }\n\n  load(id) {\n    return new Promise((resolve, reject) => {\n      if (id in this.state.cache) {\n        resolve(this.state.cache[id])\n      } else {\n        fetch(`/data/${id}.geojson`)\n          .then(response => response.json())\n          .then(response => {\n            this.state.cache[id] = response\n            resolve(response)\n          })\n          .catch(reject)\n      }\n    })\n  }\n\n  createLayer(id, options) {\n    this.setState({\n      id: id,\n      labelFeatures: options.labels\n    })\n    this.state.layer.clearLayers()\n    this.state.labels.clearLayers()\n    this.load(id)\n      .then(response => {\n        const data = Object.assign({}, response)\n        if ('filters' in options && options.filters.length) {\n          data.features = data.features.filter(feature => {\n            const valid = []\n            options.filters.forEach(item => {\n              Object.keys(item).forEach(key => {\n                if (key in feature.properties) {\n                  valid.push(feature.properties[key] === item[key])\n                }\n              })\n            })\n            return valid.indexOf(true) > -1\n          })\n        }\n        if ('selected' in options && options.selected.length) {\n          data.features = data.features.map(feature => {\n            const valid = []\n            options.selected.forEach(item => {\n              Object.keys(item).forEach(key => {\n                if (key in feature.properties) {\n                  valid.push(feature.properties[key] === item[key])\n                }\n              })\n            })\n            if (valid.indexOf(true) > -1) {\n              feature._selected = true\n            }\n            return feature\n          })\n        }\n        this.state.layer.addData(data)\n        this.state.map.fitBounds(this.state.layer.getBounds(), {padding: [0, 0]})\n      })\n  }\n\n}\n\nexport default KihMap\n"]},"metadata":{},"sourceType":"module"}